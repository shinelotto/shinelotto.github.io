{% extends "base.njk" %}

{% block content %}
<div class="chart-container">
  <!-- 顶部控制栏 -->
  <div class="chart-controls">
    <select id="zone-select">
      <option value="1">一区(1-11)</option>
      <option value="2">二区(12-22)</option>
      <option value="3">三区(23-33)</option>
    </select>
    <div class="pagination">
      <button id="prev-page">←</button>
      <span id="page-info">1/12</span>
      <button id="next-page">→</button>
    </div>
  </div>

  <!-- 图表主体 -->
  <div class="trend-grid">
    <div class="header-row">
      <div class="cell">期号</div>
      <div class="cell">星期</div>
      {% for num in range(1, 34) %}
      <div class="cell num-header">{{ num }}</div>
      {% endfor %}
      <div class="cell">和值</div>
      <div class="cell">奇偶比</div>
    </div>
    
    {% for item in ssqhistory.slice(0, 20) %}
    <div class="data-row">
      <div class="cell period">{{ item.id }}</div>
      <div class="cell weekday">{{ getWeekday(item.id) }}</div>
      
      {% for num in range(1, 34) %}
      <div class="cell num-cell {% if item.redBalls.includes(num) %}marked{% endif %}">
        {% if item.redBalls.includes(num) %}●{% endif %}
      </div>
      {% endfor %}
      
      <div class="cell sum">{{ item.sum }}</div>
      <div class="cell ratio">{{ item.oddEven }}</div>
    </div>
    {% endfor %}
  </div>
</div>

<style>
.trend-grid {
  display: grid;
  grid-template-columns: repeat(36, 1fr);
  overflow-x: auto;
}
.header-row, .data-row {
  display: contents;
}
.cell {
  padding: 8px;
  text-align: center;
  border-bottom: 1px solid #eee;
}
.num-header {
  font-size: 12px;
  color: #666;
}
.marked {
  background-color: rgba(231, 76, 60, 0.2);
}
.marked::after {
  content: '●';
  color: #e74c3c;
}
.period {
  font-weight: bold;
}
.sum, .ratio {
  background: #f8f9fa;
}
</style>

<script>
// 分页控制
let currentPage = 1;
document.getElementById('next-page').addEventListener('click', () => {
  currentPage++;
  loadPage(currentPage);
});
document.getElementById('prev-page').addEventListener('click', () => {
  if(currentPage > 1) currentPage--;
  loadPage(currentPage);
});

function loadPage(page) {
  fetch(`/api/trend-data?page=${page}`)
    .then(r => r.json())
    .then(data => {
      // 更新表格数据
      document.getElementById('page-info').textContent = `${page}/${data.totalPages}`;
    });
}
</script>
{% endblock %}