<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>红球和值统计 - 双色球数据分析</title>
    <!-- 修正样式路径（回退四级） -->
    <link rel="stylesheet" href="../../../../../css/style.css">
</head>
<body>
    <header>
        <h1>红球和值统计</h1>
        <p>EASY TO BUY, EASY TO WIN</p>
    </header>

    <!-- 导航栏（保持与AC值页面结构一致） -->
    <nav>
        <ul>
            <li><a href="../../../../../index.html">返回主页</a></li>
            <li><a href="../../history.html">历史开奖</a></li>
            <li class="dropdown">
                <a href="javascript:void(0)" class="active">统计指标</a>
                <div class="dropdown-content">
                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)">红球</a>
                        <div class="dropdown-subcontent">
                            <div class="dropdown-submenu">
                                <a href="javascript:void(0)">静态指标</a>
                                <div class="dropdown-subcontent">
                                    <a href="sum.html" class="active">和值</a>
                                    <a href="span.html">跨度</a>
                                    <a href="ac.html">AC值</a>
                                    <a href="zone-ratio.html">区间比</a>
                                    <a href="odd-even.html">奇偶比</a>
                                    <a href="road012.html">012路</a>
                                    <a href="consecutive.html">连号</a>
                                    <a href="same-tail.html">同尾</a>
                                </div>
                            </div>
                            <div class="dropdown-submenu">
                                <a href="javascript:void(0)">动态指标</a>
                                <div class="dropdown-subcontent">
                                    <a href="../red-dynamic/cold-hot.html">冷热比</a>
                                    <a href="../red-dynamic/repeat.html">重号</a>
                                    <a href="../red-dynamic/neighbor.html">邻号</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)">蓝球</a>
                        <div class="dropdown-subcontent">
                            <a href="../../statistics/blue/zone4.html">四区</a>
                            <a href="../../statistics/blue/size.html">大小</a>
                            <a href="../../statistics/blue/odd-even.html">奇偶</a>
                            <a href="../../statistics/blue/cold-hot.html">冷热</a>
                            <a href="../../statistics/blue/amplitude.html">振幅</a>
                            <a href="../../statistics/blue/tail.html">尾数</a>
                        </div>
                    </div>
                </div>
            </li>
            <li><a href="../../cold-numbers.html">冷门统计</a></li>
            <li><a href="../../prediction.html">脑机结合预测</a></li>
        </ul>
    </nav>

    <!-- 数据展示区域（保持与AC值页面相同结构） -->
    <main id="stat-container">
        <div class="filter-controls">
            <label for="year-filter">选择年份:</label>
            <select id="year-filter">
                <option value="all">全部</option>
                <!-- 年份选项通过JavaScript动态添加 -->
            </select>
            <button id="filter-button">筛选</button>
            <button id="reset-button">重置</button>
        </div>

        <div class="card">
            <h3>红球和值分布</h3>
            <div class="chart-container">
                <canvas id="sum-chart"></canvas>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>和值范围</th>
                            <th>出现次数</th>
                            <th>出现频率</th>
                            <th>平均间隔</th>
                            <th>最大间隔</th>
                            <th>当前遗漏</th>
                        </tr>
                    </thead>
                    <tbody id="sum-data">
                        <!-- 数据通过JavaScript动态填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2023 双色球数据分析系统. 保留所有权利.</p>
    </footer>

    <!-- 图表库和脚本（路径回退四级） -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../../../../js/statistics.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const loading = document.createElement('div');
            loading.className = 'loading';
            loading.textContent = '数据加载中...';
            document.getElementById('stat-container').prepend(loading);

            try {
                // 1. 加载数据（使用与AC值相同的加载方式）
                const data = await loadCSVData();
                
                // 2. 初始化年份筛选
                initYearFilter(data);
                
                // 3. 默认显示全部数据
                updateSumDisplay(data);

                // 事件监听（保持与AC值页面相同的交互逻辑）
                document.getElementById('filter-button').addEventListener('click', () => {
                    const year = document.getElementById('year-filter').value;
                    updateSumDisplay(filterDataByYear(data, year));
                });

                document.getElementById('reset-button').addEventListener('click', () => {
                    document.getElementById('year-filter').value = 'all';
                    updateSumDisplay(data);
                });

            } catch (error) {
                console.error('加载失败:', error);
                document.querySelector('.loading').textContent = '数据加载失败，请检查控制台';
            } finally {
                loading.remove();
            }
        });

        // 专用显示更新函数
        function updateSumDisplay(filteredData) {
            // 使用与AC值相同的统计计算方式（参数改为'sum'）
            const results = calculateRedStatic(filteredData, 'sum');
            
            // 清空现有数据
            const tbody = document.getElementById('sum-data');
            tbody.innerHTML = '';
            
            // 填充表格数据
            results.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.range}</td>
                    <td>${item.count}</td>
                    <td>${item.frequency}%</td>
                    <td>${item.avgGap}</td>
                    <td>${item.maxGap}</td>
                    <td>${item.currentGap}</td>
                `;
                tbody.appendChild(row);
            });

            // 渲染图表（使用与AC值相同的图表配置）
            renderSumChart({
                labels: results.map(r => r.range),
                counts: results.map(r => r.count),
                frequencies: results.map(r => parseFloat(r.frequency))
            });
        }

        // 专用图表渲染函数
        function renderSumChart(data) {
            const ctx = document.getElementById('sum-chart').getContext('2d');
            
            // 销毁旧图表实例
            if (window.sumChart) window.sumChart.destroy();
            
            window.sumChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: '出现次数',
                        data: data.counts,
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }, {
                        label: '出现频率 (%)',
                        data: data.frequencies,
                        type: 'line',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '红球和值分布趋势'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '出现次数'
                            }
                        },
                        y1: {
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '频率 (%)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>