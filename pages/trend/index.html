<!DOCTYPE html>
<html>
<head>
    <title>基本走势图</title>
    <link rel="stylesheet" href="../../css/basic-trend.css">
    <style>
        /* 新增分页样式 */
        .pagination {
            margin: 20px 0;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .pagination a {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            background: #fff;
            transition: all 0.3s;
        }
        .pagination a:hover {
            background: #f8f8f8;
        }
        .pagination a.active {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        /* 表格滚动容器 */
        .scroll-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        /* 原有样式保持不变 */
        .trend-table {
            width: auto;
            border-collapse: collapse;
        }
        .column-header {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 8px;
            min-width: 40px;
            position: sticky;
            left: 0;
            z-index: 2;
        }
        /* ... 其他原有样式 ... */
    </style>
</head>
<body>
    <div class="trend-container">
        <!-- 分页控件 -->
        <div class="pagination" id="paginationTop"></div>
        
        <!-- 表格滚动容器 -->
        <div class="scroll-container">
            <table class="trend-table">
                <!-- 表头结构保持不变 -->
                <thead>
                    <tr>
                        <th class="column-header period-cell">期号</th>
                        <!-- 各区标题... -->
                    </tr>
                    <tr>
                        <th class="column-header period-cell"></th>
                        <!-- 各号码标题... -->
                    </tr>
                </thead>
                
                <!-- 数据行 -->
                <tbody id="dataBody"></tbody>
            </table>
        </div>

        <!-- 底部分页控件 -->
        <div class="pagination" id="paginationBottom"></div>
    </div>

    <script>
        // 配置参数
        const ITEMS_PER_PAGE = 10; // 每页显示10期
        let currentPage = 1;
        let allData = [];

        // 加载CSV数据
        async function loadData() {
            try {
                const response = await fetch('../../data/ssqhistory.csv');
                const csvText = await response.text();
                return parseCSV(csvText);
            } catch (error) {
                console.error('数据加载失败:', error);
                return [];
            }
        }

        // 解析CSV数据
        function parseCSV(csvText) {
            const lines = csvText.split('\n').slice(1); // 跳过标题行
            return lines.filter(line => line).map(line => {
                const [period, red1, red2, red3, red4, red5, red6, blue] = line.split(',');
                return {
                    period: period.trim(),
                    red: [red1, red2, red3, red4, red5, red6].map(Number)
                };
            }).reverse(); // 倒序显示最新数据在前
        }

        // 生成数据行
        function createDataRow(data) {
            const row = document.createElement('tr');
            
            // 期号单元格
            const periodCell = document.createElement('td');
            periodCell.className = 'period-cell';
            periodCell.textContent = data.period;
            row.appendChild(periodCell);

            // 生成33个红球单元格
            for(let num = 1; num <= 33; num++){
                const cell = document.createElement('td');
                cell.className = 'number-cell';
                
                // 计算遗漏值
                const lastAppearIndex = allData.findIndex(d => d.red.includes(num));
                const missCount = lastAppearIndex === -1 ? allData.length : allData.length - lastAppearIndex;

                if(data.red.includes(num)) {
                    const ball = document.createElement('div');
                    ball.className = 'red-ball';
                    ball.textContent = num.toString().padStart(2, '0');
                    
                    const miss = document.createElement('span');
                    miss.className = 'miss';
                    miss.textContent = '0';
                    ball.appendChild(miss);
                    
                    cell.appendChild(ball);
                } else {
                    const miss = document.createElement('span');
                    miss.className = 'miss';
                    miss.textContent = missCount;
                    cell.appendChild(miss);
                }
                
                row.appendChild(cell);
            }

            // 生成尾数单元格
            const tails = data.red.map(n => n % 10);
            for(let t = 0; t <= 9; t++){
                const cell = document.createElement('td');
                cell.className = 'number-cell';
                
                if(tails.includes(t)) {
                    const ball = document.createElement('div');
                    ball.className = 'red-ball';
                    ball.textContent = t;
                    cell.appendChild(ball);
                }
                
                row.appendChild(cell);
            }

            return row;
        }

        // 渲染表格
        function renderTable(pageData) {
            const tbody = document.getElementById('dataBody');
            tbody.innerHTML = '';
            pageData.forEach(data => tbody.appendChild(createDataRow(data)));
        }

        // 渲染分页控件
        function renderPagination(totalPages) {
            const paginationHtml = [];
            
            // 上一页
            if(currentPage > 1) {
                paginationHtml.push(`<a href="#" onclick="changePage(${currentPage - 1})">‹</a>`);
            }

            // 页码
            for(let i = 1; i <= totalPages; i++) {
                paginationHtml.push(
                    `<a href="#" onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>${i}</a>`
                );
            }

            // 下一页
            if(currentPage < totalPages) {
                paginationHtml.push(`<a href="#" onclick="changePage(${currentPage + 1})">›</a>`);
            }

            document.getElementById('paginationTop').innerHTML = paginationHtml.join('');
            document.getElementById('paginationBottom').innerHTML = paginationHtml.join('');
        }

        // 换页函数
        window.changePage = function(newPage) {
            currentPage = newPage;
            const { paginatedData, totalPages } = paginateData(allData, currentPage, ITEMS_PER_PAGE);
            renderTable(paginatedData);
            renderPagination(totalPages);
            window.scrollTo(0, 0);
        }

        // 分页处理（从main.js中复用）
        function paginateData(data, page, itemsPerPage) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            return {
                paginatedData: data.slice(startIndex, endIndex),
                totalPages: Math.ceil(data.length / itemsPerPage)
            };
        }

        // 初始化
        window.onload = async () => {
            allData = await loadData();
            const { paginatedData, totalPages } = paginateData(allData, currentPage, ITEMS_PER_PAGE);
            renderTable(paginatedData);
            renderPagination(totalPages);
        };
    </script>
</body>
</html>